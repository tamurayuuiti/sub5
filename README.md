# Picross Solver プロジェクト概要

## プログラムの特徴
本プロジェクトは、JavaScriptのみで構成されたピクロス（ノノグラム）自動解答Webアプリです。ブラウザ上で動作し、追加のサーバーや外部ライブラリは不要です。

### ソルバーの仕組み
- **ヒューマンスティック（論理推論）**
  - 各行・列の候補パターン（getLinePossibilities）を全探索的に生成し、現状の確定セル情報で矛盾する候補を除外します（filterPossibilitiesByFixed）。
  - 各セルについて「全ての候補で同じ値になる」場合のみ、そのセルを確定値として埋めます（getCertaintiesFromPoss）。
  - dirtyフラグ方式により、変更があった行・列のみ候補・確定値を再計算し、無駄な計算を大幅に削減しています。
  - 候補が空になった時点で即エラーを返し、無駄な探索を防ぎます。
  - この処理は「人間的な論理解法」に近く、解ける範囲まで自動で埋めます。
- **バックトラック（全探索）**
  - ヒューマンスティックで埋まらない場合、残りの未確定セルを含む行ごとに候補を再帰的に全探索します。
  - 各行の候補ごとに仮置きし、現時点で矛盾しないか（isValidSoFarLine）を都度チェックしながら進めます。
  - 途中経過や解が見つかった時点で逐次UIに反映されます。
  - 試行回数が多すぎる場合は自動で中断し、ユーザーに通知します。

#### 技術的なアルゴリズム詳細
- **候補生成（getLinePossibilities）**
  - 各行・列のヒント（例: [3,1]）から、長さNの0/1配列の全パターンを再帰的に生成します。
  - 例: 長さ5, ヒント[2] → [1,1,0,0,0], [0,1,1,0,0], ...
- **候補のフィルタリング**
  - 既に確定しているセル（null/-1/0/1）と矛盾する候補を除外します。
- **確定値の抽出**
  - 残った候補の全てで同じ値になるセルのみを「確定」として埋めます。
- **dirtyフラグによる効率化**
  - 変更があった行・列のみ再計算し、全体の計算量を削減します。
- **バックトラック探索**
  - ヒューマンスティックで埋まらない場合、未確定行の候補を1つずつ仮定し、再帰的に次の行へ進みます。
  - 各仮定ごとに現時点で矛盾しないか（isValidSoFarLine）を都度判定し、矛盾があれば即バックトラックします。
  - 解が見つかった時点で探索を終了します。
- **ヒント矛盾検出**
  - ユーザー入力のヒントに対し、合計値や配置可能性などの矛盾を事前に検出し、エラー表示します。

### UI・入力方式
- 行・列ヒントは「エディタ風」または「テキストボックス型」で入力可能。
- グリッドサイズ（行数・列数）は1～200まで指定可能。
- 解答中は試行回数・経過時間がリアルタイムで表示されます。
- 解答が見つからない場合やヒントに矛盾がある場合はエラー表示。

### 主なファイル構成
- `index.html` : UIの骨組み。ヒント入力欄・グリッド・操作ボタン・プレビューなどを配置。
- `style.css` : 全体のレイアウト・グリッド・ヒント入力欄などのスタイル。
- `hint-input.css` : ヒント入力欄（エディタ風・テキストボックス型）の詳細スタイル。
- `main.js` : UI制御・グリッド描画・タイマー・エラー表示・ヒント検証などのロジック。
- `hint-input.js` : ヒント入力欄の生成・値取得・スタイル切替・バリデーション等。
- `solver.js` : ピクロス解答ロジック本体。ヒューマンスティックとバックトラック探索を組み合わせて解を導出。
- `solverHandler.js` : 「解く」ボタン押下時の処理、ソルバーの進行管理、途中経過・エラー表示など。

## 使い方（簡易手順）
1. 行数・列数を指定し「グリッド生成」
2. 行・列ヒントを入力
3. 「解く」ボタンで自動解答
4. 結果はグリッドとプレビューで確認可能

## 注意事項
- 大きなグリッドや複雑なヒントでは計算時間が長くなる場合があります。
- 試行回数が一定値を超えると自動で処理を中断します。

---

本プロジェクトは、ピクロスの論理的な解法を効率的に実装したサンプルとしても活用できます。
